def format_prompt(claim_text, categories):
    category_str = ",\n  ".join([f'"{cat}"' for cat in categories])
    
    prompt = f"""
You are an expert ...

### Task ###
Extract the most relevant category or categories (from the list below) mentioned in the claim text and provide the exact quoted span that describes the incident.

### Category List ###
[
  {category_str}
]

### Instructions ###
- If a relevant incident matches any category in the list, extract it and output in JSON format: {{ "category_name": "exact text span" }}.
- If multiple categories apply, include all of them.
- If no existing category matches but a new category is implied, generate a new category label in slug-format (e.g., "humidifier-leak") and use it as a key in the output.
- If nothing relevant is found, output blank: {{}}
- Respond ONLY with a **valid JSON object**. Do NOT include explanations or extra text.

### Claim ###
\"{claim_text}\"

### Response ###
""".strip()
    return prompt
